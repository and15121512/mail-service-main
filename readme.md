
### mail-service ###

Приложение, предназначенное для согласования задач по почте. Т.к. оно учебное, почтовые сервисы не используются, а все высылаемые письма сбрасываются в лог инициирующего их сервиса.

Основной сценарий использования следующий:

1. Авторизация пользователя.
2. Создание задачи. Сама задача определяется списком логинов согласующих, назавнием и описанием задачи. Пользователю выдаётся идентификатор созданной задачи. Задача находится в статусе "В процессе".
3. Сразу после создания приложение отправляет письмо (в текущей версии только пишет письмо в лог) первому согласующему из списка с ссылками "Согласовать" и "Не согласовать".
4. Если согласующий переходит по ссылке "Согласовать", высылается аналогичное письмо второму согласующему. Если переходит по ссылке "Не согласовать", задача переходит в статус "Отменена" и процесс рассылки останавливается.
5. Шаг 4 повторяется до тех пор, пока очередным согласующим не будет выбрана ссылка "Не согласовать" или пока не будут получены ответы "Согласовать" от всех согласующих. Во втором случае задача переходит в статус "Выполнена".
6. Есть возможность изменения параметров задачи (с последующим перезуапуском цепочки согласований) или удаления задачи.
7. Также в любой момент времени пользователь может запросить отчёт со статистикой по работе приложения. По идентификатору задачи выдаётся список промежутков времени, прошедших от отправки письма каждому согласующему и до нажатия им на ссылку в письме. Также выводится общее количество полностью согласованных и отменённых задач.

Приложение не имеет графического интерфейса, взимодействие происходит посредством REST. При тестировании приложения **рекомендуется использовать коллекцию Postman**, расположенную в этом репозитории по пути: /postman-collections/mail-service. Порядок выполнения запросов коллекции ожидается такой:

1. Auth/login --- получение access и refresh токенов.
2. Task/create task --- создание задачи, возвращаемый идентификатор задачи запомнится Postman'ом и будет подставляться в другие запросы.
3. Task/approve --- нажатие ссылки "Согласовать" из письма согласующим. Т.к. ссылки выводятся только в лог Task-сервиса, подтянуть автоматически Postman'ом их не получится. Поэтому нужно скопировать их вручную. При этом нужен лишь URL-параметр token из ссылки, с остальным справится сам Postman. Нужно скопировать из лога token и вставить его в Postman'е в URL-параметр token. Пример лога, жирным выделен токен для копирования:
    mail-service-task_1       | {"level":"info","ts":1667738283.0801215,"caller":"mail/mail.go:37","msg":"SendApprovalMail: {\n\t\"Destination\": \"MyLogin3\",\n\t\"ApprovalLink\": \"http s://127.0.0.1:3000/tasks/85c7ccd1-5ccf-4a66-b274-9caf347db9cc/approve?token=**3538446592003af7d6729ce9eabb06abc3dbcfe2**\\u0026decision=approve\",\n\t\"DeclineLink\": \"http s://127.0.0.1:3000/tasks/85c7ccd1-5ccf-4a66-b274-9caf347db9cc/approve?token=**3538446592003af7d6729ce9eabb06abc3dbcfe2**\\u0026decision=decline\"\n}","request_id":"9fc64df87aaa/4YxZjjWrHr-000009","method":"POST","url":"/tasks/85c7ccd1-5ccf-4a66-b274-9caf347db9cc/approve?token=d936c46e696d433edb7b488f801ad9a153d487e2&decision=approve"}
4. Task/decline --- комментарий аналогичен предыдущему approve. За исключением того, что этот запрос для отправки ответа "Не согласовать".
4. Task/get task --- запрос на получение информации о задаче.
5. Analytics/report --- статистика по задаче и в целом по сервису.
